(this["webpackJsonpreact-epic"]=this["webpackJsonpreact-epic"]||[]).push([[3],{58:function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var r=n(0),i=n(12),o=n(26),c=n(27),s=n(6),a=(n(44),n(1)),u=n(19),l=n.n(u);l.a.init({appId:"pEHKxT7XjpcGSREkeBOiHSSE-gzGzoHsz",appKey:"NSUTizoCqWxnF0N2s5MEQsiJ",serverURL:"https://pehkxt7x.lc-cn-n1-shared.com"});var p,b,f,j,h,O,y,g,d,m,v,w,x,U,P=function(e,t){var n=new u.User;return n.setUsername(e),n.setPassword(t),new Promise((function(e,t){n.signUp().then((function(t){e(t)}),(function(e){t(e)}))}))},k=function(e,t){return new Promise((function(n,r){u.User.logIn(e,t).then((function(e){return n(e)}),(function(e){return r(e)}))}))},z=function(){u.User.logOut().then()},F=function(){return l.a.User.current()},D=function(e,t){var n=new l.a.Object("Image"),r=new l.a.File(t,e);return n.set("filename",t),n.set("owner",l.a.User.current()),n.set("image",r),new Promise((function(e,t){n.save().then((function(t){console.log("\u4fdd\u5b58\u6210\u529f"),e(t)}),(function(e){console.log("\u4fdd\u5b58\u5931\u8d25"),t(e)}))}))},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=new l.a.Query("Image");return n.include("owner"),n.limit(t),n.skip((e-1)*t),n.descending("createdAt"),n.equalTo("owner",l.a.User.current()),new Promise((function(e,t){n.find().then((function(t){return e(t)})).catch((function(e){return t(e)}))}))},C=function(e){var t=l.a.Object.createWithoutData("Image",e);return new Promise((function(e,n){t.destroy().then((function(t){console.log("\u5220\u9664\u56fe\u7247"),e(t)})).catch((function(e){n(e)}))}))},L=new(p=function(){function e(){Object(o.a)(this,e),Object(i.a)(this,"currentUser",b,this),Object(a.m)(this)}return Object(c.a)(e,[{key:"getUser",value:function(){this.currentUser=F()}},{key:"resetUser",value:function(){this.currentUser=null}}]),e}(),b=Object(s.a)(p.prototype,"currentUser",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Object(s.a)(p.prototype,"getUser",[a.f],Object.getOwnPropertyDescriptor(p.prototype,"getUser"),p.prototype),Object(s.a)(p.prototype,"resetUser",[a.f],Object.getOwnPropertyDescriptor(p.prototype,"resetUser"),p.prototype),p),I=n(92),E=new(f=function(){function e(){Object(o.a)(this,e),Object(i.a)(this,"list",j,this),Object(i.a)(this,"isLoading",h,this),Object(i.a)(this,"hasMore",O,this),Object(i.a)(this,"page",y,this),this.limit=10,Object(a.m)(this)}return Object(c.a)(e,[{key:"append",value:function(e){this.list=this.list.concat(e)}},{key:"find",value:function(){var e=this;this.isLoading=!0,this.hasMore&&S(this.page,this.limit).then((function(t){e.append(t),Object(a.o)((function(){e.page+=1,t.length<e.limit&&(e.hasMore=!1)}))})).catch((function(){I.b.error("\u52a0\u8f7d\u5931\u8d25").then()})).finally((function(){Object(a.o)((function(){e.isLoading=!1}))}))}},{key:"remove",value:function(e){var t=this;C(e).then((function(){I.b.success("\u5220\u9664\u6210\u529f").then();var n=t.list.findIndex((function(t){return t.id===e}));Object(a.o)((function(){t.list.splice(n,1)}))})).catch((function(){return I.b.error("\u5220\u9664\u56fe\u7247\u5931\u8d25")}))}},{key:"reset",value:function(){this.isLoading=!1,this.list=[],this.page=1,this.hasMore=!0,this.limit=10}}]),e}(),j=Object(s.a)(f.prototype,"list",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h=Object(s.a)(f.prototype,"isLoading",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),O=Object(s.a)(f.prototype,"hasMore",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),y=Object(s.a)(f.prototype,"page",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Object(s.a)(f.prototype,"append",[a.f],Object.getOwnPropertyDescriptor(f.prototype,"append"),f.prototype),Object(s.a)(f.prototype,"find",[a.f],Object.getOwnPropertyDescriptor(f.prototype,"find"),f.prototype),Object(s.a)(f.prototype,"remove",[a.f],Object.getOwnPropertyDescriptor(f.prototype,"remove"),f.prototype),Object(s.a)(f.prototype,"reset",[a.f],Object.getOwnPropertyDescriptor(f.prototype,"reset"),f.prototype),f),M=new(g=function(){function e(){Object(o.a)(this,e),Object(i.a)(this,"filename",d,this),Object(i.a)(this,"file",m,this),Object(i.a)(this,"isUploading",v,this),Object(i.a)(this,"serverFile",w,this),Object(a.m)(this)}return Object(c.a)(e,[{key:"setFilename",value:function(e){this.filename=e}},{key:"setFile",value:function(e){this.file=e}},{key:"upload",value:function(){var e=this;return this.isUploading=!0,this.serverFile=null,new Promise((function(t,n){D(e.file,e.filename).then((function(n){Object(a.o)((function(){e.serverFile=n})),t(n)})).catch((function(e){n(e)})).finally((function(){Object(a.o)((function(){e.isUploading=!1}))}))}))}},{key:"reset",value:function(){this.serverFile=null,this.isUploading=!1}}]),e}(),d=Object(s.a)(g.prototype,"filename",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),m=Object(s.a)(g.prototype,"file",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=Object(s.a)(g.prototype,"isUploading",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),w=Object(s.a)(g.prototype,"serverFile",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Object(s.a)(g.prototype,"setFilename",[a.f],Object.getOwnPropertyDescriptor(g.prototype,"setFilename"),g.prototype),Object(s.a)(g.prototype,"setFile",[a.f],Object.getOwnPropertyDescriptor(g.prototype,"setFile"),g.prototype),Object(s.a)(g.prototype,"upload",[a.f],Object.getOwnPropertyDescriptor(g.prototype,"upload"),g.prototype),Object(s.a)(g.prototype,"reset",[a.f],Object.getOwnPropertyDescriptor(g.prototype,"reset"),g.prototype),g),N=new(x=function(){function e(){Object(o.a)(this,e),Object(i.a)(this,"values",U,this),Object(a.m)(this)}return Object(c.a)(e,[{key:"setUsername",value:function(e){this.values.username=e}},{key:"setPassword",value:function(e){this.values.password=e}},{key:"login",value:function(){var e=this;return new Promise((function(t,n){k(e.values.username,e.values.password).then((function(e){console.log("\u767b\u5f55\u6210\u529f"),L.getUser(),t(e)})).catch((function(e){I.b.error("\u767b\u5f55\u5931\u8d25").then(),n(e)}))}))}},{key:"register",value:function(){var e=this;return new Promise((function(t,n){P(e.values.username,e.values.password).then((function(e){console.log("\u6ce8\u518c\u6210\u529f"),L.getUser(),t(e)})).catch((function(e){I.b.error("\u6ce8\u518c\u5931\u8d25").then(),L.resetUser(),n(e)}))}))}},{key:"logout",value:function(){z(),L.resetUser(),E.reset(),M.reset()}}]),e}(),U=Object(s.a)(x.prototype,"values",[a.n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{username:"",password:""}}}),Object(s.a)(x.prototype,"setUsername",[a.f],Object.getOwnPropertyDescriptor(x.prototype,"setUsername"),x.prototype),Object(s.a)(x.prototype,"setPassword",[a.f],Object.getOwnPropertyDescriptor(x.prototype,"setPassword"),x.prototype),Object(s.a)(x.prototype,"login",[a.f],Object.getOwnPropertyDescriptor(x.prototype,"login"),x.prototype),Object(s.a)(x.prototype,"register",[a.f],Object.getOwnPropertyDescriptor(x.prototype,"register"),x.prototype),Object(s.a)(x.prototype,"logout",[a.f],Object.getOwnPropertyDescriptor(x.prototype,"logout"),x.prototype),x),H=Object(r.createContext)({AuthStore:N,UserStore:L,ImageStore:M,HistoryStore:E}),T=function(){return Object(r.useContext)(H)}},87:function(e,t,n){},88:function(e,t,n){"use strict";n.r(t);var r,i,o,c,s,a,u=n(0),l=n(20),p=n.n(l),b=n(8),f=n(24),j=n(35),h=n(25),O=n(89),y=n(58),g=n(63),d=n(4),m=h.a.header(r||(r=Object(f.a)(["\n  background-color: #02101f;\n  padding: 10px 100px;\n  display: flex;\n  align-items: center;\n  color: #fff;\n"]))),v=Object(h.a)(j.b)(i||(i=Object(f.a)(["\n  color: #fff;\n  margin-left: 30px;\n\n  &.active {\n    border-bottom: 1px solid #fff;\n  }\n"]))),w=h.a.a(o||(o=Object(f.a)(["\n  color:#fff;\n  margin-left: 30px;\n  font-size:15px;\n  &.active {\n    border-bottom:1px solid #fff;\n  }\n"]))),x=Object(h.a)(O.a)(c||(c=Object(f.a)(["\n  margin-left: 10px;\n"]))),U=h.a.div(s||(s=Object(f.a)(["\n  margin-left: auto;\n"]))),P=Object(g.a)((function(){var e=Object(y.a)(),t=e.UserStore,n=e.AuthStore,r=Object(b.f)();return Object(u.useEffect)((function(){t.getUser()}),[t]),Object(d.jsxs)(m,{children:[Object(d.jsxs)("nav",{children:[Object(d.jsx)(v,{to:"/",activeClassName:"active",exact:!0,children:"\u9996\u9875"}),Object(d.jsx)(v,{to:"/history",activeClassName:"active",children:"\u4e0a\u4f20\u5386\u53f2"}),Object(d.jsx)(w,{href:"https://github.com/lichen404/react-epic",target:"_blank",rel:"noreferrer",children:"Github"})]}),Object(d.jsx)(U,{children:t.currentUser?Object(d.jsxs)(d.Fragment,{children:[t.currentUser.attributes.username,Object(d.jsx)(x,{type:"primary",onClick:function(){n.logout()},children:"\u6ce8\u9500"})]}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(x,{type:"primary",onClick:function(){r.push("/login")},children:"\u767b\u5f55"}),Object(d.jsx)(x,{type:"primary",onClick:function(){r.push("/register")},children:"\u6ce8\u518c"})]})})]})})),k=h.a.footer(a||(a=Object(f.a)(["\n  padding: 10px 100px;\n  text-align:center;\n  font-size: 14px;\n  color: #aaa;\n  \n"]))),z=function(){return Object(d.jsx)(k,{children:Object(d.jsx)("span",{children:"WTFPL Licensed | Copyright \xa9 2021 Li Chen"})})},F=function(){return Object(d.jsx)("div",{children:"Loading..."})},D=(n(87),Object(u.lazy)((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(6),n.e(8)]).then(n.bind(null,263))}))),S=Object(u.lazy)((function(){return Promise.all([n.e(0),n.e(2),n.e(7)]).then(n.bind(null,262))})),C=Object(u.lazy)((function(){return Promise.all([n.e(0),n.e(1),n.e(9)]).then(n.bind(null,256))})),L=Object(u.lazy)((function(){return Promise.all([n.e(0),n.e(1),n.e(10)]).then(n.bind(null,257))}));var I=function(){return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(P,{}),Object(d.jsxs)("div",{className:"mainWrapper",children:[Object(d.jsx)("main",{children:Object(d.jsx)(u.Suspense,{fallback:F(),children:Object(d.jsxs)(b.c,{children:[Object(d.jsx)(b.a,{path:"/",exact:!0,children:Object(d.jsx)(D,{})}),Object(d.jsx)(b.a,{path:"/history",children:Object(d.jsx)(S,{})}),Object(d.jsx)(b.a,{path:"/login",children:Object(d.jsx)(C,{})}),Object(d.jsx)(b.a,{path:"/register",children:Object(d.jsx)(L,{})})]})})}),Object(d.jsx)(z,{})]})]})};p.a.render(Object(d.jsx)(j.a,{children:Object(d.jsx)(I,{})}),document.getElementById("root"))}},[[88,4,5]]]);
//# sourceMappingURL=main.3feb6c83.chunk.js.map